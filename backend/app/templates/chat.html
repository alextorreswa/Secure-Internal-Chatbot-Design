<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cascade Freight ‚Äì Secure Chatbot Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: light dark;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .shell {
      margin: 24px;
      width: 100%;
      max-width: 960px;
      background: #020617;
      border-radius: 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
      overflow: hidden;
    }

    .header {
      padding: 16px 20px;
      border-bottom: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: radial-gradient(circle at top left, #0ea5e9 0, #020617 40%, #020617 100%);
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-name {
      font-weight: 700;
      letter-spacing: .06em;
      font-size: 0.9rem;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .brand-subtitle {
      font-size: 0.8rem;
      color: #cbd5f5;
    }

    .user-badge {
      text-align: right;
      font-size: 0.8rem;
      color: #cbd5f5;
    }

    .user-badge span {
      display: block;
    }

    .user-role {
      font-weight: 600;
      text-transform: capitalize;
    }

    .main {
      display: grid;
      grid-template-columns: minmax(0, 2.3fr) minmax(0, 1.4fr);
    }

    @media (max-width: 840px) {
      .main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .chat-panel {
      border-right: 1px solid #111827;
      display: flex;
      flex-direction: column;
      min-height: 420px;
    }

    .chat-log {
      flex: 1;
      padding: 16px 18px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #4b5563 #020617;
    }

    .chat-log::-webkit-scrollbar {
      width: 6px;
    }

    .chat-log::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .message {
      max-width: 90%;
      margin-bottom: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 0.9rem;
      white-space: pre-wrap;
    }

    .message.user {
      margin-left: auto;
      background: #1d4ed8;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.bot {
      margin-right: auto;
      background: #020617;
      border: 1px solid #1f2937;
      border-bottom-left-radius: 4px;
    }

    .message-meta {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-bottom: 2px;
    }

    .input-row {
      padding: 10px 12px;
      border-top: 1px solid #111827;
      display: flex;
      gap: 8px;
    }

    .input-row textarea {
      flex: 1;
      resize: none;
      border-radius: 12px;
      border: 1px solid #1f2937;
      padding: 8px 10px;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      min-height: 44px;
      max-height: 120px;
    }

    .input-row button {
      border-radius: 12px;
      border: none;
      padding: 0 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      background: #22c55e;
      color: #022c22;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 80px;
    }

    .input-row button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .sidebar {
      padding: 14px 16px 16px;
      background: radial-gradient(circle at top right, #22c55e 0, #020617 40%, #020617 100%);
    }

    .sidebar-section {
      margin-bottom: 14px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid #1f2937;
    }

    .sidebar-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 6px;
      color: #9ca3af;
    }

    .sidebar-body {
      font-size: 0.78rem;
      color: #e5e7eb;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.45);
      margin: 2px 2px 4px 0;
      cursor: pointer;
    }

    .pill span {
      opacity: 0.9;
    }

    .footer-bar {
      border-top: 1px solid #111827;
      padding: 6px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: #9ca3af;
      background: #020617;
    }

    a.link {
      color: #38bdf8;
      text-decoration: none;
    }

    a.link:hover {
      text-decoration: underline;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      margin-right: 6px;
    }
  </style>
</head>
<body>
<div class="shell">
  <header class="header">
    <div class="brand">
      <div class="brand-name">CASCADE FREIGHT SYSTEMS</div>
      <div class="brand-subtitle">Secure In-House Chatbot Prototype</div>
    </div>
    <div class="user-badge">
      <span>{{ full_name }} ({{ username }})</span>
      <span class="user-role">{{ role }}</span>
      <span><a class="link" href="/logout">Log out</a></span>
    </div>
  </header>

  <div class="main">
    <!-- Chat panel -->
    <section class="chat-panel">
      <div id="chat-log" class="chat-log">
        <div class="message bot">
          <div class="message-meta">CascadeBot ‚Ä¢ system</div>
          <div>
            Welcome, {{ full_name }} üëã - Your role is <strong>{{ role }}</strong>.  
            <br/>
            I can help you demo key features from the Cascade Freight design:
            <ul style="margin-top: 3px; padding-left: 18px;">
              <li>Shipment tracking (e.g., <code>Track shipment CFS-1001</code>)</li>
              <li>Dispatch / driver questions</li>
              <li>Safety & HR policy questions</li>
              <li>Contact directory (Dispatch, HR, IT)</li>
              <li>Compliance checklist guidance (for Compliance & Admin roles)</li>
            </ul>
          </div>
        </div>
      </div>

      <form id="chat-form" class="input-row">
        <textarea id="message-input" placeholder="Ask something like &quot;Track shipment CFS-1001&quot; or &quot;What is the hazmat safety policy?&quot;"></textarea>
        <button type="submit" id="send-button">Send</button>
      </form>
    </section>

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Quick prompts</div>
        <div class="sidebar-body">
          <div class="pill" data-prompt="Track shipment CFS-1001">
            <span>üöö Track shipment CFS-1001</span>
          </div>
          <div class="pill" data-prompt="What is the hazmat safety policy?">
            <span>‚ö†Ô∏è Hazmat safety policy</span>
          </div>
          <div class="pill" data-prompt="Contact HR">
            <span>üìá Contact HR</span>
          </div>
          <div class="pill" data-prompt="Show me an internal audit checklist">
            <span>üìã Compliance checklist</span>
          </div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">What this demonstrates</div>
        <div class="sidebar-body">
          ‚Ä¢ Secure login and role-based access  
          ‚Ä¢ Natural-language queries  
          ‚Ä¢ Role-aware answers (Dispatcher vs Driver vs Admin)  
          ‚Ä¢ Audit logging via the backend `/api/chat` endpoint  
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Demo tips</div>
        <div class="sidebar-body">
          1. Log in as different roles (dispatcher, compliance, admin).<br/>
          2. Ask the same question and show how answers change.<br/>
          3. Open <code>/admin/logs</code> as admin to show recent chat logs.
        </div>
      </div>
    </aside>
  </div>

  <div class="footer-bar">
    <div style="display:flex;align-items:center;">
      <div class="status-dot"></div>
      <span>Prototype ‚Äì all data stays on localhost for this demo.</span>
    </div>
    <div>
      Backend: FastAPI ‚Ä¢ Frontend: Jinja2 HTML
    </div>
  </div>
</div>

<script>
  const form = document.getElementById("chat-form");
  const input = document.getElementById("message-input");
  const chatLog = document.getElementById("chat-log");
  const sendButton = document.getElementById("send-button");

  function appendMessage(text, sender, meta) {
    const wrapper = document.createElement("div");
    wrapper.classList.add("message");
    wrapper.classList.add(sender === "user" ? "user" : "bot");

    if (meta) {
      const metaEl = document.createElement("div");
      metaEl.classList.add("message-meta");
      metaEl.textContent = meta;
      wrapper.appendChild(metaEl);
    }

    const body = document.createElement("div");
    body.textContent = text;
    wrapper.appendChild(body);

    chatLog.appendChild(wrapper);
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  async function sendMessage(evt) {
    evt.preventDefault();
    const text = input.value.trim();
    if (!text) return;

    appendMessage(text, "user", "You");
    input.value = "";
    input.focus();
    sendButton.disabled = true;

    try {
      const res = await fetch("/api/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ message: text })
      });

      if (!res.ok) {
        const errorData = await res.json().catch(() => ({}));
        const msg = errorData.detail || "Error contacting chatbot API.";
        appendMessage(msg, "bot", "CascadeBot ‚Ä¢ error");
      } else {
        const data = await res.json();
        const meta = `CascadeBot ‚Ä¢ ${data.topic} ‚Ä¢ role: ${data.role}`;
        appendMessage(data.reply, "bot", meta);
      }
    } catch (err) {
      appendMessage("Network error talking to the backend API.", "bot", "CascadeBot ‚Ä¢ error");
    } finally {
      sendButton.disabled = false;
    }
  }

  form.addEventListener("submit", sendMessage);

  // Quick prompt pills
  document.querySelectorAll(".pill").forEach((pill) => {
    pill.addEventListener("click", () => {
      const prompt = pill.getAttribute("data-prompt");
      input.value = prompt;
      input.focus();
    });
  });
</script>
</body>
</html>
